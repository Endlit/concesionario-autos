<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Ventas</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href='https://cdn.boxicons.com/3.0.5/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn.boxicons.com/3.0.5/fonts/brands/boxicons-brands.min.css' rel='stylesheet'>
</head>

<body class="op">
<a class="btn" th:href="@{/}">Volver</a>
<h1>Ventas</h1>

    <form th:action="@{/ventas/save}" method="post">
        <div>
            <label>Vendedor</label>
            <select name="vendedorDni" required>
                <option th:each="u : ${usuarios}" th:value="${u.dni}" th:text="${u.nombre + ' (' + u.rol + ')'}">
                </option>
            </select>
        </div>

        <div>
            <label>Vehículo nuevo (matrícula)</label>
            <select name="vehiculoMatricula" required>
                <option th:each="vh : ${vehiculos}" th:value="${vh.matricula}"
                    th:text="${vh.marca + ' ' + vh.modelo + ' (' + vh.matricula + ')'}"></option>
            </select>
        </div>

        <div>
            <label>Cliente que entrega vehículo usado (opcional)</label>
            <select name="clienteDni">
                <option value="">-- Ninguno --</option>
                <option th:each="u : ${usuarios}" th:value="${u.dni}" th:text="${u.nombre + ' (' + u.dni + ')'}">
                </option>
            </select>
        </div>

        <div>
            <label>Matrícula vehículo usado entregado (opcional)</label>
            <input type="text" name="vehiculoUsadoMatricula" />
        </div>

        <div>
            <label>Precio venta</label>
            <input type="number" step="0.01" name="precioVenta" />
        </div>

        <div>
            <label>Opciones</label>
            <select name="opcionIds" multiple size="5">
                <option th:each="op : ${opciones}" th:value="${op.id}" th:text="${op.nombre}"></option>
            </select>
        </div>

        <button type="submit">Registrar venta</button>
    </form>

    <h2>Listado de ventas</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Fecha</th>
                <th>Vendedor</th>
                <th>Vehículo</th>
                <th>Precio</th>
                <th>Opciones</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="vt : ${ventas}">
                <td th:text="${vt.id}"></td>
                <td th:text="${vt.fecha}"></td>
                <td th:text="${vt.vendedor != null ? vt.vendedor.nombre : '-'}"></td>
                <td th:text="${vt.vehiculo != null ? vt.vehiculo.matricula : '-'}"></td>
                <td th:text="${vt.precioVenta}"></td>
                <td>
                    <span th:each="vo, iter : ${vt.opciones}">
                        <span th:text="${vo.opcion.nombre}"></span>
                        <span th:if="${!iter.last}"> + </span>
                    </span>
                </td>

                <td>
                    <a th:href="@{'/ventas/delete/' + ${vt.id}}" data-delete><i class='bxr bx-trash'
                            style='color:#000000'></i></a>
                </td>
            </tr>
        </tbody>
    </table>

    <script th:src="@{/js/app.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>