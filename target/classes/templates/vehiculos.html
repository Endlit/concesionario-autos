<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Vehículos</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href='https://cdn.boxicons.com/3.0.5/fonts/basic/boxicons.min.css' rel='stylesheet'>
    <link href='https://cdn.boxicons.com/3.0.5/fonts/brands/boxicons-brands.min.css' rel='stylesheet'>
</head>

<body class="op">
<a class="btn" th:href="@{/}">Volver</a>
<h1>Vehículos</h1>

    <form th:action="@{/vehiculos/save}" method="post" th:object="${vehiculo}">
        <div>
            <label>Matrícula</label>
            <input type="text" th:field="*{matricula}" required />
        </div>

        <div>
            <label>Marca</label>
            <input type="text" th:field="*{marca}" />
        </div>

        <div>
            <label>Modelo</label>
            <input type="text" th:field="*{modelo}" />
        </div>

        <div>
            <label>Cilindrada</label>
            <input type="text" th:field="*{cilindrada}" />
        </div>

        <div>
            <label>Precio</label>
            <input type="number" step="0.01" th:field="*{precio}" />
        </div>

        <!-- NUEVO: fechaCesion -->
        <div>
            <input type="hidden" id="fechaCesion" th:field="*{fechaCesion}">
        </div>

        <div>
            <label>Cliente (opcional)</label>
            <select name="clienteDni">
                <option value="">-- Ninguno --</option>
                <option th:each="u : ${usuarios}" th:value="${u.dni}" th:text="${u.nombre + ' (' + u.dni + ')'}">
                </option>
            </select>
        </div>

        <button type="submit">Guardar</button>
    </form>


    <h2>Listado</h2>
    <table>
        <thead>
            <tr>
                <th>Matricula</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Precio</th>
                <th>Fecha Cesión</th>
                <th>Cliente</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="v : ${vehiculos}">
                <td th:text="${v.matricula}"></td>
                <td th:text="${v.marca}"></td>
                <td th:text="${v.modelo}"></td>
                <td th:text="${v.precio}"></td>

                <!-- Mostrar fecha o '-' -->
                <td th:text="${v.fechaCesion != null ? v.fechaCesion : '-'}"></td>

                <td th:text="${v.cliente != null ? v.cliente.nombre : '-'}"></td>

                <td>
                    <a th:href="@{'/vehiculos/delete/' + ${v.matricula}}" data-delete><i class='bxr bx-trash'
                            style='color:#000000'></i></a>
                </td>
            </tr>
        </tbody>
    </table>

    <script th:src="@{/js/vehiculos.js}"></script>
    <script th:src="@{/js/app.js}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>

</html>